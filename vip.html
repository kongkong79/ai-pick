<!DOCTYPE html>
<html lang="en" data-theme="light">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>VIP Access - BetMetrics</title>
    <link rel="stylesheet" href="style.css?v=110">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <style>
        #vip-unlocked-section { display: flex; flex-direction: column; align-items: center; width: 100%; }
        .summary-card { margin: 20px auto !important; width: 95%; max-width: 900px; background: var(--card-bg); border-radius: 12px; box-shadow: 0 4px 6px rgba(0,0,0,0.1); overflow: hidden; }
        .summary-header { background: #007bff; color: white; padding: 15px; font-weight: bold; display: flex; justify-content: space-between; align-items: center; }
        .summary-table { width: 100%; border-collapse: collapse; }
        .summary-table th, .summary-table td { padding: 15px 10px; text-align: center !important; border-bottom: 1px solid #eee; }
        .badge-banker { background: #d1fae5; color: #065f46; padding: 4px 8px; border-radius: 4px; font-weight: bold; border: 1px solid #10b981; margin-left: 5px; font-size: 0.8rem; }
        [data-theme="dark"] .summary-table td { color: #f1f5f9; border-bottom: 1px solid #334155; }
        [data-theme="dark"] .summary-table tr { background: #1e293b; }
        #more-btn-container { padding: 20px; background: var(--card-bg); border-top: 1px solid #eee; }
        .view-more-btn { width: 100%; padding: 12px; background: #f8f9fa; border: 1px dashed #ccc; cursor: pointer; border-radius: 8px; font-weight: bold; color: #666; transition: 0.3s; }
        .download-btn { background: #ffffff; color: #007bff; border: none; padding: 6px 12px; border-radius: 6px; font-size: 0.8rem; cursor: pointer; font-weight: bold; }
        .hidden-row { display: none; }
        
        /* Ï∂îÍ∞ÄÎêú VIP ÏΩ§Î≥¥ Ïä§ÌÉÄÏùº */
        .vip-combo-container { width: 95%; max-width: 900px; margin: 20px auto; }
        .vip-combo-card { background: linear-gradient(135deg, #1e3a8a, #2563eb); color: white; padding: 20px; border-radius: 15px; box-shadow: 0 4px 15px rgba(37,99,235,0.3); }
    </style>
</head>
<body>
    <header>
        <div class="container">
            <a href="index.html" class="logo-link">
                 <img src="betmetrics.png?v=3" alt="BetMetrics Logo" class="logo-img">
                 <div class="logo-text-group">
                     <span class="logo-main-text">BetMetrics</span>
                     <span class="logo-sub-text">AI Analysis</span>
                 </div>
            </a>
            <nav>
                <a href="index.html" class="nav-link">Home</a>
                <a href="vip.html" class="nav-link active">VIP</a>
            </nav>
        </div>
    </header>

    <main class="container">
        <section id="vip-locked-section" class="hero" style="display: none;">
            <h1 style="color: #fbbf24;">‚≠ê VIP Premium Member</h1>
            <div class="analysis-list-item" style="max-width: 500px; margin: 40px auto; border: 2px solid #fbbf24; text-align: center; padding: 30px; border-radius: 15px;">
                <div class="lock-icon" style="font-size: 50px;">üîí</div>
                <h3>VIP Exclusive Benefits</h3>
                <p>Access 80%+ Win Rate AI Reports</p>
                <a href="https://kongkong79.gumroad.com/l/ai-sports-vip" target="_blank" class="nav-link" style="display: block; background: #fbbf24; color: #000; padding: 15px; border-radius: 12px; font-weight: 800; text-decoration: none; margin: 20px 0;">Subscribe Now ($9.99)</a>
                <input type="text" id="vip-code-input" placeholder="Enter Code" style="padding: 10px; width: 60%; border-radius: 4px; border: 1px solid #ccc;">
                <button onclick="verifyVipCode()" style="padding: 10px 20px; background: #007bff; color: white; border: none; border-radius: 4px; cursor: pointer;">Verify</button>
            </div>
        </section>

        <section id="vip-unlocked-section" style="display: none;">
            <h1 style="color: #007bff;">‚úÖ VIP Member Zone</h1>
            
            <div id="vip-combo-display" class="vip-combo-container"></div>

            <div class="summary-card">
                <div class="summary-header">
                    <span id="header-title">üî• AI Smart Picks</span>
                    <button class="download-btn" id="dl-btn" onclick="downloadExcel()">üì• Download Excel</button>
                </div>
                <table class="summary-table">
                    <tbody id="vip-data-body"></tbody>
                </table>
                <div id="more-btn-container" style="display: none;">
                    <button class="view-more-btn" onclick="toggleMoreMatches()" id="more-btn">+ Load More Matches</button>
                </div>
            </div>
            
            <button onclick="logoutVip()" style="margin-top: 20px; color: gray; background: none; border: none; text-decoration: underline; cursor: pointer;">Logout</button>
        </section>
    </main>

<script>
    const VIP_CODE = "FEB888";

    async function initVipPage() {
    const tbody = document.getElementById('vip-data-body');
    const comboDiv = document.getElementById('vip-combo-display'); // Ï°∞Ìï©Ïù¥ Îì§Ïñ¥Í∞à ÏûêÎ¶¨
    const userLang = navigator.language || navigator.userLanguage;
    const isKo = userLang.includes('ko');

    const texts = {
        noticeTitle: isKo ? "‚ö†Ô∏è ÌïÑÎèÖ Ï£ºÏùòÏÇ¨Ìï≠:" : "‚ö†Ô∏è Important Notice:",
        noticeDesc: isKo 
            ? "ÏõêÏ†ïÌåÄ ÏäπÎ¶¨(Away Win) Ï∂îÏ≤ú Í≤ΩÍ∏∞Îäî 'ÏõêÏ†ï ÏßÄÏßÄ ÏïäÏùå' ÏúÑÏ£ºÎ°ú Ï†ëÍ∑ºÌïòÏÑ∏Ïöî."
            : "For 'Away Win' picks, we suggest 'Away Team Not to Lose'.",
        comboTitle: isKo ? "üéØ Ïò§ÎäòÏùò AI VIP 3Î∞∞ ÏàòÏùµ Ï°∞Ìï©" : "üéØ Today's AI VIP 300% Combo",
        more: isKo ? "+ Îçî ÎßéÏùÄ Í≤ΩÍ∏∞ Î≥¥Í∏∞" : "+ View More Matches",
        download: isKo ? "üì• ÏóëÏÖÄ Îã§Ïö¥Î°úÎìú" : "üì• Download Excel"
    };

    try {
        const response = await fetch('sports_data.xlsx?v=' + Math.random());
        const arrayBuffer = await response.arrayBuffer();
        const data = new Uint8Array(arrayBuffer);
        const workbook = XLSX.read(data, { type: 'array' });
        const sheet = workbook.Sheets[workbook.SheetNames[0]];
        const rows = XLSX.utils.sheet_to_json(sheet, { header: 1, defval: 0 });

        // 1. Îç∞Ïù¥ÌÑ∞ ÌååÏã±
        const dataRows = rows.slice(1).map(row => {
            const hit = typeof row[5] === 'string' ? parseFloat(row[5].replace('%','')) : (row[5] > 1 ? row[5] : row[5]*100);
            return {
                time: row[0], home: row[1], away: row[2], odds: parseFloat(row[3]),
                pick: String(row[4]), hitRate: hit, samples: parseInt(row[11])
            };
        }).filter(r => r.samples >= 10);

        // 2. 3Î∞∞ Ï°∞Ìï© Ï∂îÏ∂ú (ÌïÑÌÑ∞ÎßÅ ÏôÑÌôî: Ï†ÅÏ§ëÎ•† 65% Ïù¥ÏÉÅÏúºÎ°ú Ï°∞Ï†ï)
        const comboCandidates = dataRows.filter(r => r.hitRate >= 65 && r.odds >= 1.4);
        let bestCombo = null;
        
        if (comboCandidates.length >= 2) {
            // Î∞∞Îãπ Ìï©Ïù¥ 2.7 ~ 4.0 ÏÇ¨Ïù¥Ïù∏ Ï°∞Ìï© Ï∞æÍ∏∞
            for(let i=0; i<comboCandidates.length; i++) {
                for(let j=i+1; j<comboCandidates.length; j++) {
                    const total = comboCandidates[i].odds * comboCandidates[j].odds;
                    if (total >= 2.7 && total <= 4.0) {
                        bestCombo = [comboCandidates[i], comboCandidates[j], total];
                        break;
                    }
                }
                if(bestCombo) break;
            }
        }

        // 3. Ï°∞Ìï© ÏÑπÏÖò Î†åÎçîÎßÅ (ÌôîÎ©¥Ïóê ÌôïÏã§Ìûà Î≥¥Ïù¥Í≤å Ïä§ÌÉÄÏùº Î≥¥Í∞ï)
        if (bestCombo && comboDiv) {
            const [m1, m2, finalOdds] = bestCombo;
            const getFinalPick = (m) => (m.pick.includes("Away") && m.hitRate <= 5) ? "üõ°Ô∏è AH 0 (Away)" : m.pick;
            
            comboDiv.innerHTML = `
                <div class="vip-combo-card" style="margin-bottom: 25px; border: 2px solid #facc15;">
                    <div style="text-align:center; margin-bottom:15px;">
                        <span style="background:#facc15; color:#000; padding:4px 12px; border-radius:20px; font-size:0.75rem; font-weight:bold;">SPECIAL COMBO</span>
                        <h2 style="margin:8px 0; font-size:1.3rem; color:#fff;">${texts.comboTitle}</h2>
                    </div>
                    <div style="display:grid; grid-template-columns: 1fr 1fr; gap:10px; border-top:1px solid rgba(255,255,255,0.2); padding-top:15px;">
                        <div style="background:rgba(255,255,255,0.1); padding:12px; border-radius:8px;">
                            <div style="opacity:0.8; font-size:0.7rem; color:#facc15;">MATCH 01</div>
                            <strong style="font-size:0.9rem;">${m1.home} vs ${m1.away}</strong><br>
                            <span style="color:#4ade80; font-weight:bold;">${getFinalPick(m1)}</span>
                        </div>
                        <div style="background:rgba(255,255,255,0.1); padding:12px; border-radius:8px;">
                            <div style="opacity:0.8; font-size:0.7rem; color:#facc15;">MATCH 02</div>
                            <strong style="font-size:0.9rem;">${m2.home} vs ${m2.away}</strong><br>
                            <span style="color:#4ade80; font-weight:bold;">${getFinalPick(m2)}</span>
                        </div>
                    </div>
                    <div style="text-align:center; margin-top:15px; background: rgba(0,0,0,0.2); padding: 10px; border-radius: 10px;">
                        <span style="font-size:1rem;">Total Odds: </span>
                        <span style="font-size:1.6rem; color:#facc15; font-weight:900;">${finalOdds.toFixed(2)}x</span>
                    </div>
                </div>
            `;
        }

        // 4. Î¶¨Ïä§Ìä∏ Î†åÎçîÎßÅ (Í∏∞Ï°¥ Î°úÏßÅ ÎèôÏùº)
        tbody.innerHTML = `<tr class="notice-row"><td colspan="4" style="background: #fff9db; color: #856404; padding: 15px; font-size: 0.85rem; border-bottom: 2px solid #ffeeba; text-align: left !important;"><strong>${texts.noticeTitle}</strong> <br>${texts.noticeDesc}</td></tr>`;

        dataRows.forEach((row, index) => {
            const isHomeWin = row.pick.includes("Home");
            const homeStyle = isHomeWin ? "font-weight:bold;" : "color:#888;";
            const awayStyle = !isHomeWin ? "font-weight:bold;" : "color:#888;";
            
            let displayPick = isHomeWin ? 'üè† Home Win' : '‚úàÔ∏è Away Win';
            if (!isHomeWin && row.hitRate <= 5) displayPick = 'üõ°Ô∏è AH 0 (Away)';
            if (row.odds > 0 && row.odds <= 1.15) displayPick += ' <span class="badge-banker">‚≠ê Banker</span>';

            const tr = document.createElement('tr');
            if (index >= 7) tr.className = 'hidden-row';

            tr.innerHTML = `
                <td style="text-align:left !important; padding-left:20px;">
                    <span style="font-size:0.7rem; color:gray; display:block;">${row.time}</span>
                    <span style="${homeStyle}">${row.home}</span> <span style="color:#ccc;">vs</span> <span style="${awayStyle}">${row.away}</span>
                </td>
                <td style="font-size:0.9rem;">${displayPick}</td>
                <td style="color:#059669; font-weight:bold;">${row.hitRate <= 5 ? "High(DNB)" : row.hitRate.toFixed(0) + "%"}</td>
                <td><b>${row.odds.toFixed(2)}</b><br><small style="color:#999; font-size:0.6rem;">Samples:${row.samples}</small></td>
            `;
            tbody.appendChild(tr);
        });

        if (dataRows.length > 7) document.getElementById('more-btn-container').style.display = 'block';

    } catch (err) { console.error(err); }
}
</script>
</body>
</html>
