<!DOCTYPE html>
<html lang="en" data-theme="light">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>VIP Access - BetMetrics</title>
    <link rel="stylesheet" href="style.css?v=110">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <style>
        #vip-unlocked-section { display: flex; flex-direction: column; align-items: center; width: 100%; }
        .summary-card { margin: 20px auto !important; width: 95%; max-width: 900px; background: var(--card-bg); border-radius: 12px; box-shadow: 0 4px 6px rgba(0,0,0,0.1); overflow: hidden; }
        .summary-header { background: #007bff; color: white; padding: 15px; font-weight: bold; display: flex; justify-content: space-between; align-items: center; }
        .summary-table { width: 100%; border-collapse: collapse; }
        .summary-table th, .summary-table td { padding: 15px 10px; text-align: center !important; border-bottom: 1px solid #eee; }
        .badge-banker { background: #d1fae5; color: #065f46; padding: 4px 8px; border-radius: 4px; font-weight: bold; border: 1px solid #10b981; margin-left: 5px; font-size: 0.8rem; }
        [data-theme="dark"] .summary-table td { color: #f1f5f9; border-bottom: 1px solid #334155; }
        [data-theme="dark"] .summary-table tr { background: #1e293b; }
        #more-btn-container { padding: 20px; background: var(--card-bg); border-top: 1px solid #eee; }
        .view-more-btn { width: 100%; padding: 12px; background: #f8f9fa; border: 1px dashed #ccc; cursor: pointer; border-radius: 8px; font-weight: bold; color: #666; transition: 0.3s; }
        .download-btn { background: #ffffff; color: #007bff; border: none; padding: 6px 12px; border-radius: 6px; font-size: 0.8rem; cursor: pointer; font-weight: bold; }
        .hidden-row { display: none; }
        
        /* VIP ì½¤ë³´ ìŠ¤íƒ€ì¼ */
        .vip-combo-container { width: 95%; max-width: 900px; margin: 20px auto; }
        .vip-combo-card { background: linear-gradient(135deg, #1e3a8a, #2563eb); color: white; padding: 20px; border-radius: 15px; box-shadow: 0 4px 15px rgba(37,99,235,0.3); }
    </style>
</head>
<body>
    <header>
        <div class="container">
            <a href="index.html" class="logo-link">
                 <img src="betmetrics.png?v=3" alt="BetMetrics Logo" class="logo-img">
                 <div class="logo-text-group">
                     <span class="logo-main-text">BetMetrics</span>
                     <span class="logo-sub-text">AI Analysis</span>
                 </div>
            </a>
            <nav>
                <a href="index.html" class="nav-link">Home</a>
                <a href="vip.html" class="nav-link active">VIP</a>
            </nav>
        </div>
    </header>

    <main class="container">
        <section id="vip-locked-section" class="hero" style="display: none;">
            <h1 style="color: #fbbf24;">â­ VIP Premium Member</h1>
            <div class="analysis-list-item" style="max-width: 500px; margin: 40px auto; border: 2px solid #fbbf24; text-align: center; padding: 30px; border-radius: 15px;">
                <div class="lock-icon" style="font-size: 50px;">ğŸ”’</div>
                <h3>VIP Exclusive Benefits</h3>
                <p>Access 80%+ Win Rate AI Reports</p>
                <a href="https://kongkong79.gumroad.com/l/ai-sports-vip" target="_blank" class="nav-link" style="display: block; background: #fbbf24; color: #000; padding: 15px; border-radius: 12px; font-weight: 800; text-decoration: none; margin: 20px 0;">Subscribe Now ($9.99)</a>
                <input type="text" id="vip-code-input" placeholder="Enter Code" style="padding: 10px; width: 60%; border-radius: 4px; border: 1px solid #ccc;">
                <button onclick="verifyVipCode()" style="padding: 10px 20px; background: #007bff; color: white; border: none; border-radius: 4px; cursor: pointer;">Verify</button>
            </div>
        </section>

        <section id="vip-unlocked-section" style="display: none;">
            <h1 style="color: #007bff;">âœ… VIP Member Zone</h1>
            
            <div id="vip-combo-display" class="vip-combo-container"></div>

            <div class="summary-card">
                <div class="summary-header">
                    <span id="header-title">ğŸ”¥ AI Smart Picks</span>
                    <button class="download-btn" id="dl-btn" onclick="downloadExcel()">ğŸ“¥ Download Excel</button>
                </div>
                <table class="summary-table">
                    <tbody id="vip-data-body"></tbody>
                </table>
                <div id="more-btn-container" style="display: none;">
                    <button class="view-more-btn" onclick="toggleMoreMatches()" id="more-btn">+ Load More Matches</button>
                </div>
            </div>
            
            <button onclick="logoutVip()" style="margin-top: 20px; color: gray; background: none; border: none; text-decoration: underline; cursor: pointer;">Logout</button>
        </section>
    </main>

<script>
    const VIP_CODE = "FEB888";

    // âœ… ì´ˆê¸° ì‹¤í–‰ í•¨ìˆ˜
    document.addEventListener('DOMContentLoaded', () => {
        const savedTheme = localStorage.getItem('theme') || 'light';
        document.documentElement.setAttribute('data-theme', savedTheme);
        checkStatus();
    });

    function checkStatus() {
        const isVip = localStorage.getItem('isVipUser') === 'true';
        document.getElementById('vip-locked-section').style.display = isVip ? 'none' : 'block';
        document.getElementById('vip-unlocked-section').style.display = isVip ? 'block' : 'none';
        if (isVip) initVipPage();
    }

    async function initVipPage() {
        const tbody = document.getElementById('vip-data-body');
        const comboDiv = document.getElementById('vip-combo-display');
        const userLang = navigator.language || navigator.userLanguage;
        const isKo = userLang.includes('ko');

        const texts = {
            noticeTitle: isKo ? "âš ï¸ í•„ë… ì£¼ì˜ì‚¬í•­:" : "âš ï¸ Important Notice:",
            noticeDesc: isKo ? "ì›ì •íŒ€ ìŠ¹ë¦¬(Away Win) ì¶”ì²œ ê²½ê¸°ëŠ” 'ì›ì • ì§€ì§€ ì•ŠìŒ' ìœ„ì£¼ë¡œ ì ‘ê·¼í•˜ì„¸ìš”." : "For 'Away Win' picks, we suggest 'Away Team Not to Lose'.",
            comboTitle: isKo ? "ğŸ¯ ì˜¤ëŠ˜ì˜ AI VIP 3ë°° ìˆ˜ìµ ì¡°í•©" : "ğŸ¯ Today's AI VIP 300% Combo",
            more: isKo ? "+ ë” ë§ì€ ê²½ê¸° ë³´ê¸°" : "+ View More Matches",
            download: isKo ? "ğŸ“¥ ì—‘ì…€ ë‹¤ìš´ë¡œë“œ" : "ğŸ“¥ Download Excel"
        };

        try {
            const response = await fetch('sports_data.xlsx?v=' + Math.random());
            const arrayBuffer = await response.arrayBuffer();
            const data = new Uint8Array(arrayBuffer);
            const workbook = XLSX.read(data, { type: 'array' });
            const sheet = workbook.Sheets[workbook.SheetNames[0]];
            const rows = XLSX.utils.sheet_to_json(sheet, { header: 1, defval: "" });

            if (rows.length <= 1) return;

            // 1. ë°ì´í„° ì•ˆì „ íŒŒì‹±
            const dataRows = [];
            for(let i = 1; i < rows.length; i++) {
                const row = rows[i];
                if(!row[1]) continue;

                let hit = 0;
                if (typeof row[5] === 'string') hit = parseFloat(row[5].replace('%',''));
                else hit = parseFloat(row[5]) <= 1 ? row[5]*100 : row[5];

                dataRows.push({
                    time: row[0] || "--:--",
                    home: row[1],
                    away: row[2],
                    odds: parseFloat(row[3]) || 0,
                    pick: String(row[4] || ""),
                    hitRate: hit || 0,
                    samples: parseInt(row[11]) || 0
                });
            }

            const filteredRows = dataRows.filter(r => r.samples >= 10);

            // 2. 3ë°° ì¡°í•© ì¶”ì¶œ (ë²”ìœ„ ìµœì í™”: 2.6 ~ 4.5)
            const candidates = filteredRows.filter(r => r.hitRate >= 60 && r.odds >= 1.4);
            let bestCombo = null;
            if (candidates.length >= 2) {
                for(let i=0; i<candidates.length; i++) {
                    for(let j=i+1; j<candidates.length; j++) {
                        const total = candidates[i].odds * candidates[j].odds;
                        if (total >= 2.6 && total <= 4.5) {
                            bestCombo = [candidates[i], candidates[j], total];
                            break;
                        }
                    }
                    if(bestCombo) break;
                }
            }

            // 3. ì¡°í•© ë Œë”ë§
            if (bestCombo && comboDiv) {
                const [m1, m2, finalOdds] = bestCombo;
                const getFinalPick = (m) => (m.pick.includes("Away") && m.hitRate <= 5) ? "ğŸ›¡ï¸ AH 0 (Away)" : m.pick;
                comboDiv.innerHTML = `
                    <div class="vip-combo-card" style="margin-bottom: 25px; border: 2px solid #facc15;">
                        <div style="text-align:center; margin-bottom:15px;">
                            <span style="background:#facc15; color:#000; padding:4px 12px; border-radius:20px; font-size:0.75rem; font-weight:bold;">AI COMBO</span>
                            <h2 style="margin:8px 0; font-size:1.2rem; color:#fff;">${texts.comboTitle}</h2>
                        </div>
                        <div style="display:grid; grid-template-columns: 1fr 1fr; gap:10px;">
                            <div style="background:rgba(255,255,255,0.1); padding:10px; border-radius:8px; text-align:center;">
                                <div style="font-size:0.8rem;">${m1.home}</div>
                                <div style="color:#facc15; font-weight:bold;">${getFinalPick(m1)}</div>
                            </div>
                            <div style="background:rgba(255,255,255,0.1); padding:10px; border-radius:8px; text-align:center;">
                                <div style="font-size:0.8rem;">${m2.home}</div>
                                <div style="color:#facc15; font-weight:bold;">${getFinalPick(m2)}</div>
                            </div>
                        </div>
                        <div style="text-align:center; margin-top:10px; font-size:1.3rem; font-weight:bold; color:#facc15;">
                            Total: ${finalOdds.toFixed(2)}x
                        </div>
                    </div>`;
            }

            // 4. ë¦¬ìŠ¤íŠ¸ ë Œë”ë§
            let html = `<tr class="notice-row"><td colspan="4" style="background: #fff9db; color: #856404; padding: 15px; font-size: 0.85rem; text-align: left !important;"><strong>${texts.noticeTitle}</strong> <br>${texts.noticeDesc}</td></tr>`;
            
            filteredRows.forEach((row, index) => {
                const isHomeWin = row.pick.includes("Home");
                let displayPick = isHomeWin ? 'ğŸ  Home Win' : 'âœˆï¸ Away Win';
                if (!isHomeWin && row.hitRate <= 5) displayPick = 'ğŸ›¡ï¸ AH 0 (Away)';
                if (row.odds > 0 && row.odds <= 1.15) displayPick += ' <span class="badge-banker">â­ Banker</span>';

                html += `
                    <tr ${index >= 7 ? 'class="hidden-row"' : ''}>
                        <td style="text-align:left !important; padding-left:20px;">
                            <small style="color:gray; display:block;">${row.time}</small>
                            <span style="${isHomeWin?'font-weight:bold':''}">${row.home}</span> vs <span style="${!isHomeWin?'font-weight:bold':''}">${row.away}</span>
                        </td>
                        <td>${displayPick}</td>
                        <td style="color:#059669; font-weight:bold;">${row.hitRate <= 5 ? "High(DNB)" : row.hitRate.toFixed(0) + "%"}</td>
                        <td><b>${row.odds.toFixed(2)}</b><br><small style="font-size:0.6rem; color:#999;">Samples:${row.samples}</small></td>
                    </tr>`;
            });
            tbody.innerHTML = html;
            if (filteredRows.length > 7) document.getElementById('more-btn-container').style.display = 'block';

        } catch (e) { console.error("VIP Load Error:", e); }
    }

    function toggleMoreMatches() {
        const rows = document.querySelectorAll('.hidden-row');
        const btn = document.getElementById('more-btn');
        const isHidden = rows[0].style.display !== 'table-row';
        rows.forEach(r => r.style.display = isHidden ? 'table-row' : 'none');
        btn.innerText = isHidden ? "â–² Close" : "+ View More Matches";
    }

    function verifyVipCode() {
        if (document.getElementById('vip-code-input').value === VIP_CODE) {
            localStorage.setItem('isVipUser', 'true');
            location.reload();
        } else { alert("Wrong code."); }
    }

    function logoutVip() { localStorage.removeItem('isVipUser'); location.reload(); }
    function downloadExcel() { window.location.href = 'sports_data.xlsx'; }
</script>
</body>
</html>
