<!DOCTYPE html>
<html lang="en" data-theme="light">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>VIP Access - BetMetrics</title>
    <link rel="stylesheet" href="style.css?v=110">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <style>
        #vip-unlocked-section { display: flex; flex-direction: column; align-items: center; width: 100%; }
        .summary-card { margin: 20px auto !important; width: 95%; max-width: 900px; background: var(--card-bg); border-radius: 12px; box-shadow: 0 4px 6px rgba(0,0,0,0.1); overflow: hidden; }
        .summary-header { background: #007bff; color: white; padding: 15px; font-weight: bold; display: flex; justify-content: space-between; align-items: center; }
        .summary-table { width: 100%; border-collapse: collapse; }
        .summary-table th, .summary-table td { padding: 15px 10px; text-align: center !important; border-bottom: 1px solid #eee; }
        
        /* ë±ƒì§€ ìŠ¤íƒ€ì¼ */
        .badge-banker { background: #d1fae5; color: #065f46; padding: 4px 8px; border-radius: 4px; font-weight: bold; border: 1px solid #10b981; margin-left: 5px; font-size: 0.8rem; }
        
        [data-theme="dark"] .summary-table td { color: #f1f5f9; border-bottom: 1px solid #334155; }
        [data-theme="dark"] .summary-table tr { background: #1e293b; }

        /* ë”ë³´ê¸° ë²„íŠ¼ ìŠ¤íƒ€ì¼ */
        #more-btn-container { padding: 20px; background: var(--card-bg); border-top: 1px solid #eee; }
        .view-more-btn { width: 100%; padding: 12px; background: #f8f9fa; border: 1px dashed #ccc; cursor: pointer; border-radius: 8px; font-weight: bold; color: #666; transition: 0.3s; }
        .view-more-btn:hover { background: #e9ecef; }
        [data-theme="dark"] .view-more-btn { background: #334155; border-color: #475569; color: #cbd5e1; }

        /* ë‹¤ìš´ë¡œë“œ ë²„íŠ¼ */
        .download-btn { background: #ffffff; color: #007bff; border: none; padding: 6px 12px; border-radius: 6px; font-size: 0.8rem; cursor: pointer; font-weight: bold; }
        .download-btn:hover { background: #f0f0f0; }

        /* ìˆ¨ê²¨ì§„ í–‰ */
        .hidden-row { display: none; }
    </style>
</head>
<body>
    <header>
        <div class="container">
            <a href="index.html" class="logo-link">
                 <img src="betmetrics.png?v=3" alt="BetMetrics Logo" class="logo-img">
                 <div class="logo-text-group">
                     <span class="logo-main-text">BetMetrics</span>
                     <span class="logo-sub-text">AI Analysis</span>
                 </div>
            </a>
            <nav>
                <a href="index.html" class="nav-link">Home</a>
                <a href="vip.html" class="nav-link active">VIP</a>
            </nav>
        </div>
    </header>

    <main class="container">
        <section id="vip-locked-section" class="hero" style="display: none;">
            <h1 style="color: #fbbf24;">â­ VIP Premium Member</h1>
            <div class="analysis-list-item" style="max-width: 500px; margin: 40px auto; border: 2px solid #fbbf24; text-align: center; padding: 30px; border-radius: 15px;">
                <div class="lock-icon" style="font-size: 50px;">ğŸ”’</div>
                <h3>VIP Exclusive Benefits</h3>
                <p>Access 80%+ Win Rate AI Reports</p>
                <a href="https://kongkong79.gumroad.com/l/ai-sports-vip" target="_blank" class="nav-link" style="display: block; background: #fbbf24; color: #000; padding: 15px; border-radius: 12px; font-weight: 800; text-decoration: none; margin: 20px 0;">Subscribe Now ($9.99)</a>
                <input type="text" id="vip-code-input" placeholder="Enter Code" style="padding: 10px; width: 60%; border-radius: 4px; border: 1px solid #ccc;">
                <button onclick="verifyVipCode()" style="padding: 10px 20px; background: #007bff; color: white; border: none; border-radius: 4px; cursor: pointer;">Verify</button>
            </div>
        </section>

        <section id="vip-unlocked-section" style="display: none;">
            <h1 style="color: #007bff;">âœ… VIP Member Zone</h1>
            
            <div class="summary-card">
                <div class="summary-header">
                    <span id="header-title">ğŸ”¥ AI Smart Picks</span>
                    <button class="download-btn" id="dl-btn" onclick="downloadExcel()">ğŸ“¥ Download Excel</button>
                </div>
                <table class="summary-table">
                    <tbody id="vip-data-body">
                        </tbody>
                </table>
                <div id="more-btn-container" style="display: none;">
                    <button class="view-more-btn" onclick="toggleMoreMatches()" id="more-btn">+ Load More Matches</button>
                </div>
            </div>
            
            <button onclick="logoutVip()" style="margin-top: 20px; color: gray; background: none; border: none; text-decoration: underline; cursor: pointer;">Logout</button>
        </section>
    </main>

<script>
    const VIP_CODE = "FEB888";

    async function initVipPage() {
        const tbody = document.getElementById('vip-data-body');
        const userLang = navigator.language || navigator.userLanguage;
        const isKo = userLang.includes('ko');

        const texts = {
            noticeTitle: isKo ? "âš ï¸ í•„ë… ì£¼ì˜ì‚¬í•­:" : "âš ï¸ Important Notice:",
            noticeDesc: isKo 
                ? "ì›ì •íŒ€ ìŠ¹ë¦¬(Away Win) ì¶”ì²œ ê²½ê¸°ëŠ” ë‹¨ìˆœíˆ 'ì›ì •íŒ€ì´ ì´ê¸´ë‹¤'ëŠ” ì ‘ê·¼ë³´ë‹¤ëŠ”, <strong>'ì›ì •íŒ€ì´ ì§€ì§€ ì•ŠëŠ”ë‹¤(ë¬´ìŠ¹ë¶€ í¬í•¨)'</strong>ëŠ” ì•ˆì •ì ì¸ ë°©í–¥ìœ¼ë¡œ ì ‘ê·¼í•˜ì‹œëŠ” ê²ƒì„ ê¶Œì¥í•©ë‹ˆë‹¤."
                : "For 'Away Win' picks, we suggest a conservative approach: focus on <strong>'Away Team Not to Lose (Double Chance)'</strong>.",
            samples: isKo ? "í‘œë³¸" : "Samples",
            more: isKo ? "+ ë” ë§ì€ ê²½ê¸° ë³´ê¸°" : "+ View More Matches",
            download: isKo ? "ğŸ“¥ ì—‘ì…€ ë‹¤ìš´ë¡œë“œ" : "ğŸ“¥ Download Excel"
        };

        // ë²„íŠ¼ í…ìŠ¤íŠ¸ ì´ˆê¸°í™”
        document.getElementById('more-btn').innerText = texts.more;
        document.getElementById('dl-btn').innerText = texts.download;

        try {
            const response = await fetch('sports_data.xlsx?v=' + Math.random());
            const arrayBuffer = await response.arrayBuffer();
            const data = new Uint8Array(arrayBuffer);
            const workbook = XLSX.read(data, { type: 'array' });
            const sheet = workbook.Sheets[workbook.SheetNames[0]];
            const rows = XLSX.utils.sheet_to_json(sheet, { header: 1, defval: 0 });

            tbody.innerHTML = '';
            
            // ì£¼ì˜ì‚¬í•­ ê³µì§€ ì‚½ì…
            tbody.innerHTML = `
                <tr class="notice-row">
                    <td colspan="4" style="background: #fff9db; color: #856404; padding: 15px; font-size: 0.85rem; border-bottom: 2px solid #ffeeba; text-align: left !important;">
                        <strong>${texts.noticeTitle}</strong> <br>${texts.noticeDesc}
                    </td>
                </tr>`;

            const dataRows = rows.slice(1); 
            let count = 0;

            dataRows.forEach((row) => {
                const sampleCount = parseInt(row[11]); 
                if (sampleCount < 10) return;

                const time = row[0], homeTeam = row[1], awayTeam = row[2], 
                      homeOdds = parseFloat(row[3]), aiPick = String(row[4]), hitRate = row[5];

                const isHomeWin = aiPick.includes("Home");
                const homeStyle = isHomeWin ? "font-weight:bold;" : "color:#888;";
                const awayStyle = !isHomeWin ? "font-weight:bold;" : "color:#888;";
                
                let pickHtml = isHomeWin ? '<span class="badge-home">ğŸ  Home Win</span>' : '<span class="badge-away">âœˆï¸ Away Win</span>';
                if (homeOdds > 0 && homeOdds <= 1.15) pickHtml += '<span class="badge-banker">â­ Banker</span>';

                const tr = document.createElement('tr');
                // 7ê²½ê¸°ê°€ ë„˜ì–´ê°€ë©´ í´ë˜ìŠ¤ë¥¼ ì¶”ê°€í•˜ì—¬ ìˆ¨ê¹€ ì²˜ë¦¬
                if (count >= 7) tr.className = 'hidden-row';

                tr.innerHTML = `
                    <td style="text-align:left !important; padding-left:20px;">
                        <span style="font-size:0.7rem; color:gray; display:block;">${time}</span>
                        <span style="${homeStyle}">${homeTeam}</span> <span style="color:#ccc;">vs</span> <span style="${awayStyle}">${awayTeam}</span>
                    </td>
                    <td>${pickHtml}</td>
                    <td style="color:#059669; font-weight:bold;">${hitRate}%</td>
                    <td><b>${homeOdds.toFixed(2)}</b><br><small style="color:#999; font-size:0.6rem;">${texts.samples}:${sampleCount}</small></td>
                `;
                tbody.appendChild(tr);
                count++;
            });

            // ë°ì´í„°ê°€ 7ê°œë³´ë‹¤ ë§ìœ¼ë©´ 'ë”ë³´ê¸°' ë²„íŠ¼ í™œì„±í™”
            if (count > 7) {
                document.getElementById('more-btn-container').style.display = 'block';
            }

        } catch (err) {
            console.error(err);
        }
    }

    // ë”ë³´ê¸° í† ê¸€ í•¨ìˆ˜
    function toggleMoreMatches() {
        const hiddenRows = document.querySelectorAll('.hidden-row');
        const btn = document.getElementById('more-btn');
        const userLang = navigator.language || navigator.userLanguage;
        
        if (hiddenRows.length > 0 && hiddenRows[0].style.display === 'table-row') {
            hiddenRows.forEach(row => row.style.display = 'none');
            btn.innerText = userLang.includes('ko') ? "+ ë” ë§ì€ ê²½ê¸° ë³´ê¸°" : "+ View More Matches";
        } else {
            hiddenRows.forEach(row => row.style.display = 'table-row');
            btn.innerText = userLang.includes('ko') ? "â–² ì ‘ê¸°" : "â–² Close";
        }
    }

    // ì—‘ì…€ ë‹¤ìš´ë¡œë“œ í•¨ìˆ˜
    function downloadExcel() {
        window.location.href = 'sports_data.xlsx';
    }

    function checkStatus() {
        const isVip = localStorage.getItem('isVipUser') === 'true';
        document.getElementById('vip-locked-section').style.display = isVip ? 'none' : 'block';
        document.getElementById('vip-unlocked-section').style.display = isVip ? 'block' : 'none';
        if (isVip) initVipPage();
    }
    function verifyVipCode() {
        const val = document.getElementById('vip-code-input').value;
        if (val === VIP_CODE) { localStorage.setItem('isVipUser', 'true'); location.reload(); }
        else { alert("Wrong code."); }
    }
    function logoutVip() { localStorage.removeItem('isVipUser'); location.reload(); }
    
    document.addEventListener('DOMContentLoaded', () => {
        const savedTheme = localStorage.getItem('theme') || 'light';
        document.documentElement.setAttribute('data-theme', savedTheme);
        checkStatus();
    });
</script>
</body>
</html>
